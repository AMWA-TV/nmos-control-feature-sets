# NMOS Control Feature Sets: Device configuration

Includes models for control classes and datatypes used for device configuration (see [NMOS IS-14](https://specs.amwa.tv/is-14/)).

- [NMOS Control Feature Sets: Device configuration](#nmos-control-feature-sets-device-configuration)
  - [Datatypes](#datatypes)
    - [NcPropertyTrait](#ncpropertytrait)
    - [NcPropertyValueHolder](#ncpropertyvalueholder)
    - [NcObjectPropertiesHolder](#ncobjectpropertiesholder)
    - [NcBulkValuesHolder](#ncbulkvaluesholder)
    - [NcRestoreValidationStatus](#ncrestorevalidationstatus)
    - [NcPropertyRestoreException](#ncpropertyrestoreexception)
    - [NcObjectPropertiesSetValidation](#ncobjectpropertiessetvalidation)
    - [NcMethodResultBulkValuesHolder](#ncmethodresultbulkvaluesholder)
    - [NcMethodResultObjectPropertiesSetValidation](#ncmethodresultobjectpropertiessetvalidation)
  - [Control classes](#control-classes)
    - [NcBulkPropertiesManager](#ncbulkpropertiesmanager)

## Datatypes

### NcPropertyTrait

```typescript
// Property trait enumeration
enum NcPropertyTrait {
    "General",              // 0 Property is general
    "InstanceSpecific",     // 1 Property is instance specific
    "Ephemeral",            // 2 Property is ephemeral
    "Immutable",            // 3 Property is immutable
    "DeviceGenerated",      // 4 Property value is generated by the device
    "Structural",           // 5 Property is structural (affects the device model structure)
};
```

### NcPropertyValueHolder

```typescript
// Property value holder descriptor
interface NcPropertyValueHolder {
    attribute NcPropertyId    id; // Property id
    attribute NcString    name; // Property name
    attribute NcName?    typeName; // Property type name. If null it means the type is any
    attribute NcBoolean    isReadOnly; // Is the property ReadOnly?
    attribute sequence<NcPropertyTrait> traits; // Describes the property traits as a collection of unique items
    attribute any?    value; // Property value
};
```

### NcObjectPropertiesHolder

```typescript
interface NcObjectPropertiesHolder {
    attribute NcRolePath    path; // Object role path
    attribute sequence<NcPropertyValueHolder>    values; // Object properties values
};
```

### NcBulkValuesHolder

```typescript
interface NcBulkValuesHolder {
    attribute NcString?    validationFingerprint; // Optional vendor specific fingerprinting mechanism used for validation purposes
    attribute sequence<NcObjectPropertiesHolder>    values; // Values by rolePath
};
```

### NcRestoreValidationStatus

```typescript
// Restore validation status enumeration
enum NcRestoreValidationStatus {
    "Ok",                   // 200 Restore was successful
    "PartiallyOk",          // 206 Restore was partially successful
    "Excluded",             // 210 Excluded from restore due to data provided in the request
    "InvalidData",          // 400 Restore failed because relevant backup data set provided is invalid
    "NotFound",             // 404 Restore failed because the role path is not found in the device model or the device cannot create the role path from the data set
    "MissingDependency",    // 424 Restore failed because of missing dependency information in the relevant backup data set
    "DeviceError",          // 500 Restore failed due to an internal device error preventing the restore from happening
};
```

### NcPropertyRestoreException

```typescript
interface NcPropertyRestoreException {
    attribute NcPropertyId    id;               // Property id
    attribute NcName    name;                   // Property name
    attribute NcString    exceptionMessage;     // Property restore exception message
};
```

### NcObjectPropertiesSetValidation

```typescript
interface NcObjectPropertiesSetValidation {
    attribute NcRolePath    path;                                   // Object role path
    attribute NcRestoreValidationStatus    status;                  // Validation status
    attribute sequence<NcPropertyRestoreException>    exceptions;   // Validation property exceptions
    attribute NcString?    statusMessage;                           // Validation status message
};
```

### NcMethodResultBulkValuesHolder

```typescript
interface NcMethodResultBulkValuesHolder: NcMethodResult {
    attribute NcBulkValuesHolder    value; // Bulk values holder value
};
```

### NcMethodResultObjectPropertiesSetValidation

```typescript
interface NcMethodResultObjectPropertiesSetValidation: NcMethodResult {
    attribute sequence<NcObjectPropertiesSetValidation>    value; // Object properties set path validations
};
```

## Control classes

### NcBulkPropertiesManager

The `BulkPropertiesManager` offers a central model for getting and setting properties of multiple role paths.
It also allows pre-validation of a data set before attempting to use in setting multiple properties of multiple role paths.

```typescript
// NcBulkPropertiesManager class descriptor
[control-class("1.3.3", "BulkPropertiesManager")] interface NcBulkPropertiesManager: NcManager {

    // Get bulk object properties by given path
    [element("3m1")]    NcMethodResultBulkValuesHolder GetPropertiesByPath(
        NcRolePath path,    // The target role path
        NcBoolean recurse    // If true will return properties on specified path and all the nested paths
    );

    // Validate bulk properties for setting by given paths
    [element("3m2")]    NcMethodResultObjectPropertiesSetValidation ValidateSetPropertiesByPath(
        NcBulkValuesHolder dataSet,    // The values offered (this may include read-only values and also paths which are not the target role path)
        NcRolePath path,    // The target role path
        NcBoolean recurse    // If true will validate properties on target path and all the nested paths
        sequence<NcPropertyTrait>? propertyTraits // If left null then all properties regardless of their traits will be validated for restore. When populated (not null) only properties with these specific traits are validated for restore
    );

    // Set bulk properties by given paths
    [element("3m3")]    NcMethodResultObjectPropertiesSetValidation SetPropertiesByPath(
        NcBulkValuesHolder dataSet,    // The values offered (this may include read-only values and also paths which are not the target role path)
        NcRolePath path,    // The target role path
        NcBoolean recurse    // If true will set properties on target path and all the nested paths
        sequence<NcPropertyTrait>? propertyTraits  // If left null then all properties regardless of their traits will be included in the restore. When populated (not null) only properties with these specific traits are included in the restore
    );
};
```
